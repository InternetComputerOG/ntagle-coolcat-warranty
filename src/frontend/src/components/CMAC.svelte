<script>
  import { CMAC } from "@stablelib/cmac";
  import { AES } from "@stablelib/aes";
  import { encode, decode } from "@stablelib/hex";

  var mKey = "00000000000000000000000000000000";
  var uid = "04738712647380";

  const counts = [
    '100000',
    '200000',
    '300000',
    '400000',
    '500000',
    '600000',
    '700000',
    '800000',
    '900000',
    'A00000',
    'B00000',
    'C00000',
    'D00000',
    'E00000',
    'F00000',
    '100000',
    '110000',
    '120000',
    '130000',
    '140000',
    '150000',
    '160000',
    '170000',
    '180000',
    '190000',
    '1A0000',
    '1B0000',
    '1C0000',
    '1D0000',
    '1E0000',
    '1F0000',
    '200000',
    '210000',
    '220000',
    '230000',
    '240000',
    '250000',
    '260000',
    '270000',
    '280000',
    '290000',
    '2A0000',
    '2B0000',
    '2C0000',
    '2D0000',
    '2E0000',
    '2F0000',
    '300000',
    '310000',
    '320000',
    '330000',
    '340000',
    '350000',
    '360000',
    '370000',
    '380000',
    '390000',
    '3A0000',
    '3B0000',
    '3C0000',
    '3D0000',
    '3E0000',
    '3F0000',
    '400000',
    '410000',
    '420000',
    '430000',
    '440000',
    '450000',
    '460000',
    '470000',
    '480000',
    '490000',
    '4A0000',
    '4B0000',
    '4C0000',
    '4D0000',
    '4E0000',
    '4F0000',
    '500000',
    '510000',
    '520000',
    '530000',
    '540000',
    '550000',
    '560000',
    '570000',
    '580000',
    '590000',
    '5A0000',
    '5B0000',
    '5C0000',
    '5D0000',
    '5E0000',
    '5F0000',
    '600000',
    '610000',
    '620000',
    '630000',
    '640000',
    '650000',
    '660000',
    '670000',
    '680000',
    '690000',
    '6A0000',
    '6B0000',
    '6C0000',
    '6D0000',
    '6E0000',
    '6F0000',
    '700000',
    '710000',
    '720000',
    '730000',
    '740000',
    '750000',
    '760000',
    '770000',
    '780000',
    '790000',
    '7A0000',
    '7B0000',
    '7C0000',
    '7D0000',
    '7E0000',
    '7F0000',
    '800000',
    '810000',
    '820000',
    '830000',
    '840000',
    '850000',
    '860000',
    '870000',
    '880000',
    '890000',
    '8A0000',
    '8B0000',
    '8C0000',
    '8D0000',
    '8E0000',
    '8F0000',
    '900000',
    '910000',
    '920000',
    '930000',
    '940000',
    '950000',
    '960000',
    '970000',
    '980000',
    '990000',
    '9A0000',
    '9B0000',
    '9C0000',
    '9D0000',
    '9E0000',
    '9F0000',
    'A00000',
    'A10000',
    'A20000',
    'A30000',
    'A40000',
    'A50000',
    'A60000',
    'A70000',
    'A80000',
    'A90000',
    'AA0000',
    'AB0000',
    'AC0000',
    'AD0000',
    'AE0000',
    'AF0000',
    'B00000',
    'B10000',
    'B20000',
    'B30000',
    'B40000',
    'B50000',
    'B60000',
    'B70000',
    'B80000',
    'B90000',
    'BA0000',
    'BB0000',
    'BC0000',
    'BD0000',
    'BE0000',
    'BF0000',
    'C00000',
    'C10000',
    'C20000',
    'C30000',
    'C40000',
    'C50000',
    'C60000',
    'C70000',
    'C80000',
    'C90000',
    'CA0000',
    'CB0000',
    'CC0000',
    'CD0000',
    'CE0000',
    'CF0000',
    'D00000',
    'D10000',
    'D20000',
    'D30000',
    'D40000',
    'D50000',
    'D60000',
    'D70000',
    'D80000',
    'D90000',
    'DA0000',
    'DB0000',
    'DC0000',
    'DD0000',
    'DE0000',
    'DF0000',
    'E00000',
    'E10000',
    'E20000',
    'E30000',
    'E40000',
    'E50000',
    'E60000',
    'E70000',
    'E80000',
    'E90000',
    'EA0000',
    'EB0000',
    'EC0000',
    'ED0000',
    'EE0000',
    'EF0000',
    'F00000',
    'F10000',
    'F20000',
    'F30000',
    'F40000',
    'F50000',
    'F60000',
    'F70000',
    'F80000',
    'F90000',
    'FA0000',
    'FB0000',
    'FC0000',
    'FD0000',
    'FE0000',
    'FF0000',
    '100000',
    '101000',
    '102000',
    '103000',
    '104000',
    '105000',
    '106000',
    '107000',
    '108000',
    '109000',
    '10A000',
    '10B000',
    '10C000',
    '10D000',
    '10E000',
    '10F000',
    '110000',
    '111000',
    '112000',
    '113000',
    '114000',
    '115000',
    '116000',
    '117000',
    '118000',
    '119000',
    '11A000',
    '11B000',
    '11C000',
    '11D000',
    '11E000',
    '11F000',
    '120000',
    '121000',
    '122000',
    '123000',
    '124000',
    '125000',
    '126000',
    '127000',
    '128000',
    '129000',
    '12A000',
    '12B000',
    '12C000',
    '12D000',
    '12E000',
    '12F000',
    '130000',
    '131000',
    '132000',
    '133000',
    '134000',
    '135000',
    '136000',
    '137000',
    '138000',
    '139000',
    '13A000',
    '13B000',
    '13C000',
    '13D000',
    '13E000',
    '13F000',
    '140000',
    '141000',
    '142000',
    '143000',
    '144000',
    '145000',
    '146000',
    '147000',
    '148000',
    '149000',
    '14A000',
    '14B000',
    '14C000',
    '14D000',
    '14E000',
    '14F000',
    '150000',
    '151000',
    '152000',
    '153000',
    '154000',
    '155000',
    '156000',
    '157000',
    '158000',
    '159000',
    '15A000',
    '15B000',
    '15C000',
    '15D000',
    '15E000',
    '15F000',
    '160000',
    '161000',
    '162000',
    '163000',
    '164000',
    '165000',
    '166000',
    '167000',
    '168000',
    '169000',
    '16A000',
    '16B000',
    '16C000',
    '16D000',
    '16E000',
    '16F000',
    '170000',
    '171000',
    '172000',
    '173000',
    '174000',
    '175000',
    '176000',
    '177000',
    '178000',
    '179000',
    '17A000',
    '17B000',
    '17C000',
    '17D000',
    '17E000',
    '17F000',
    '180000',
    '181000',
    '182000',
    '183000',
    '184000',
    '185000',
    '186000',
    '187000',
    '188000',
    '189000',
    '18A000',
    '18B000',
    '18C000',
    '18D000',
    '18E000',
    '18F000',
    '190000',
    '191000',
    '192000',
    '193000',
    '194000',
    '195000',
    '196000',
    '197000',
    '198000',
    '199000',
    '19A000',
    '19B000',
    '19C000',
    '19D000',
    '19E000',
    '19F000',
    '1A0000',
    '1A1000',
    '1A2000',
    '1A3000',
    '1A4000',
    '1A5000',
    '1A6000',
    '1A7000',
    '1A8000',
    '1A9000',
    '1AA000',
    '1AB000',
    '1AC000',
    '1AD000',
    '1AE000',
    '1AF000',
    '1B0000',
    '1B1000',
    '1B2000',
    '1B3000',
    '1B4000',
    '1B5000',
    '1B6000',
    '1B7000',
    '1B8000',
    '1B9000',
    '1BA000',
    '1BB000',
    '1BC000',
    '1BD000',
    '1BE000',
    '1BF000',
    '1C0000',
    '1C1000',
    '1C2000',
    '1C3000',
    '1C4000',
    '1C5000',
    '1C6000',
    '1C7000',
    '1C8000',
    '1C9000',
    '1CA000',
    '1CB000',
    '1CC000',
    '1CD000',
    '1CE000',
    '1CF000',
    '1D0000',
    '1D1000',
    '1D2000',
    '1D3000',
    '1D4000',
    '1D5000',
    '1D6000',
    '1D7000',
    '1D8000',
    '1D9000',
    '1DA000',
    '1DB000',
    '1DC000',
    '1DD000',
    '1DE000',
    '1DF000',
    '1E0000',
    '1E1000',
    '1E2000',
    '1E3000',
    '1E4000',
    '1E5000',
    '1E6000',
    '1E7000',
    '1E8000',
    '1E9000',
    '1EA000',
    '1EB000',
    '1EC000',
    '1ED000',
    '1EE000',
    '1EF000',
    '1F0000',
    '1F1000',
    '1F2000',
    '1F3000',
    '1F4000',
  ];

  function SDMMAC(count, uid, mKey) {
    var cmac = new CMAC(new AES(decode(mKey), true));

    var sv1 = "3CC300010080" + uid + count;
    cmac.update(decode(sv1));

    var k1 = encode(cmac.digest());

    var fullSDMMAC = new CMAC(new AES(decode(k1), true));
    fullSDMMAC.update(decode(""));

    var fullString = encode(fullSDMMAC.digest());

    let s1 = fullString.slice(2,4);
    let s2 = fullString.slice(6,8);
    let s3 = fullString.slice(10,12);
    let s4 = fullString.slice(14,16);

    return (s1 + s2 + s3 + s4).toUpperCase();
  };
</script>

<input bind:value={uid}>
<input bind:value={mKey}>
{#each counts as count}
  {SDMMAC(count, uid, mKey)}, 
{/each}